<!doctype html><html itemscope itemtype=https://schema.org/WebPage class=no-js lang=en><head prefix="og: http://ogp.me/ns#"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=siteBaseUrl content="https://www.my-universe.com/"><meta name=author content="daemotron"><meta name=description content="Mens Insana in Corpore Ignavo"><meta name=keywords content="blog,developer,personal"><meta name=generator content="Hugo 0.142.0"><title>Configuration to Go | My Universe
</title><meta itemprop=name content="Configuration to Go"><meta itemprop=description content="Configuration to Go - Mens Insana in Corpore Ignavo"><meta property="og:site_name" content="My Universe"><meta property="og:url" content="https://www.my-universe.com/2024/04/06/configuration-to-go/"><meta property="og:site_name" content="My Universe"><meta property="og:title" content="Configuration to Go"><meta property="og:description" content="One of the boilerplate tasks for nearly every (application development) project is the implementation of an application configuration management. In most cases, applications have aspects we want to be configurable, e.g. the port a server listens on, the language an UI starts with or the database connection an application shall use. The twelve-factor app methodology propagates using environment variables for this purpose, but what might be a good idea for cloud-deployed web apps wonâ€™t work equally well for desktop applications or in traditional deployment scenarios. For them, more traditional ways like configuration files or command line flags might be a better choice."><meta property="og:locale" content="en_gb"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-06T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-06T00:00:00+00:00"><meta property="article:tag" content="Development"><meta property="article:tag" content="Go"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><script src=/modernizr-simple.js></script><link rel=canonical href=https://www.my-universe.com/2024/04/06/configuration-to-go/><link rel=stylesheet href=https://www.my-universe.com/theme.css></head><body class=bilberry-hugo-theme><nav><div class=container><ul class=topnav><li><a href=https://www.my-universe.com/page/about/>About</a></li><li><a href=https://www.my-universe.com/page/legal/>Legal</a></li></ul></div></nav><header><div class=container><div class=logo><a href=/ class=logo><img src=/img/avataaars.png alt>
<span class=overlay><i class="fa fa-home"></i></span></a></div><div class=titles><h3 class=title><a href=/>My Universe</a></h3><span class=subtitle>Mens Insana in Corpore Ignavo</span></div><div class=toggler><i class="fa fa-bars" aria-hidden=true></i></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=https://www.my-universe.com/2024/04/06/configuration-to-go/><i class="fas fa-fw fa-pencil-alt"></i></a><article class="default article"><div class=content><h1 class=article-title><a href=https://www.my-universe.com/2024/04/06/configuration-to-go/>Configuration to Go</a></h1><div class=meta><span class="date moment">2024-04-06</span>
<span class=categories><a href=https://www.my-universe.com/categories/go/>Go</a></span></div><p>One of the boilerplate tasks for nearly every (application development) project is the implementation of an application configuration management. In most cases, applications have aspects we want to be configurable, e.g. the port a server listens on, the language an UI starts with or the database connection an application shall use. <a href=https://12factor.net/>The twelve-factor app methodology</a> propagates using environment variables for this purpose, but what might be a good idea for cloud-deployed web apps won&rsquo;t work equally well for desktop applications or in traditional deployment scenarios. For them, more traditional ways like configuration files or command line flags might be a better choice.</p><p>Therefore, configuration solutions like <a href=https://github.com/spf13/viper>Viper</a> have gained populiarity. They combine various inflow paths for configuration information and bundle them in one path-agnostic interface, allowing the application developer to use configuration information without having to care how the information was provided to the application.</p><h4 id=appconf-for-go>Appconf for Go</h4><p>With <a href=https://github.com/daemotron/appconf>Appconf for Go</a> I implemented my own configuration solution for Go &mdash; while inspired by Viper, it is much more leightweight and doesn&rsquo;t have any dependencies outside of Go&rsquo;s standard library. And other than Viper, it makes assumptions about configuration file locations (in line with XDG) and provides default paths for storing data, cache and configuration files. And finally, it was a great little project to learn the ropes of Go and familiarize with interfaces, pointers and similar Go-isms.</p><p>Adding Appconf to an existing Go project is simple:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>got get github.com/daemotron/appconf
</span></span></code></pre></div><p>Appconf doesn&rsquo;t require much setup; you only have to register the configuration options you want it to manage for your application:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>package</span> main
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>import</span> (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#f1fa8c>&#34;github.com/daemotron/appconf&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#f1fa8c>&#34;log&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#6272a4>// initialize configuration context</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    conf <span style=color:#ff79c6>:=</span> appconf.<span style=color:#50fa7b>NewConf</span>(<span style=color:#f1fa8c>&#34;MyApp&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#6272a4>// register configuration option</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    err <span style=color:#ff79c6>:=</span> conf.<span style=color:#50fa7b>NewOption</span>(<span style=color:#f1fa8c>&#34;foo&#34;</span>, appconf.<span style=color:#50fa7b>WithDefaultString</span>(<span style=color:#f1fa8c>&#34;bar&#34;</span>), appconf.<span style=color:#50fa7b>WithFlag</span>(<span style=color:#f1fa8c>&#34;f&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        log.<span style=color:#50fa7b>Fatalf</span>(<span style=color:#f1fa8c>&#34;Error: %v&#34;</span>, err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>	
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#6272a4>// update configuration from files, environment and command line flags</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    err = conf.<span style=color:#50fa7b>Update</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#ff79c6>if</span> err <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        log.<span style=color:#50fa7b>Fatalf</span>(<span style=color:#f1fa8c>&#34;Error: %v&#34;</span>, err)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>}
</span></span></code></pre></div><p>The sample code above registers a single configuration option called &ldquo;foo&rdquo;, with a default value of &ldquo;bar&rdquo; (indirectly setting the type of this option to <code>string</code>). The option is tied to the command line flag <code>f</code>, so if the application is launched with <code>-f baz</code>, foo&rsquo;s value will be &ldquo;baz&rdquo; instead of &ldquo;bar&rdquo;.</p><h4 id=appconf-from-scratch>Appconf from Scratch</h4><p>But lets start with the Appconf configuration context. As shown in the example above, it is created by calling the <code>NewConf()</code> function. <code>NewConf()</code> only has one mandatory paramter, namely the application name, passed as <code>string</code>. Beyond the application name, <code>NewConf()</code> understands a couple of functional options:</p><ul><li><code>WithAuthor(string)</code> lets you pass an author or publisher name for the application</li><li><code>WithVersion(string)</code> lets you pass a version string for the application</li><li><code>WithConfFile(string)</code> lets you set a single configuration file (absolute path preferred)</li><li><code>WithConfFiles([]string)</code> lets you set a list of configuration files</li><li><code>WithRoaming()</code> lets you chose to use the <code>roaming</code> instead of the <code>local</code> directory structure (applies only to Windows)</li></ul><p>App name, author, version and the roaming flag influence the various paths Appconf can provide &mdash; e.g. <code>conf.UserDataDir()</code> returns the user-specific data directory for your appliction (e.g. <code>~/.local/share/&lt;AppName></code> on Linux). If you don&rsquo;t want author or version be used in those paths, just omit their respective functional arguments. Btw. Appconf implements all directories in the same manner as the (now deprecated) <a href=https://github.com/ActiveState/appdirs>appdirs</a> Python package by ActiveState.</p><h4 id=options-from-scratch>Options from Scratch</h4><p>But Appconf isn&rsquo;t mostly about directories, but rather about configuration options, so let&rsquo;s take a closer look at those. Similar to <code>NewConf()</code>, registering a configuration option only requires a unique key (or name) passed as <code>string</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>err <span style=color:#ff79c6>:=</span> conf.<span style=color:#50fa7b>NewOption</span>(<span style=color:#f1fa8c>&#34;foo&#34;</span>)
</span></span></code></pre></div><p>This short statement is already sufficient to register a new option in the <code>conf</code> context. Its value can now be set with one of the value setters:</p><ul><li><code>conf.SetBool("foo", true)</code> sets the value of &ldquo;foo&rdquo; to the boolean value <code>true</code></li><li><code>conf.SetFloat("foo", 123.456)</code> sets the value of &ldquo;foo&rdquo; to the float64 value <code>123.456</code></li><li><code>conf.SetInt("foo", 123)</code> sets the value of &ldquo;foo&rdquo; to the int value <code>123</code></li><li><code>conf.SetString("foo", "bar")</code> sets the value of &ldquo;foo&rdquo; to the string <code>"bar"</code></li></ul><p>Querying values for a key works the same way, just using the <code>GetInt</code>, <code>GetFloat</code>, <code>GetBool</code> and <code>GetString</code> methods.</p><h4 id=no-fault-by-default>No Fault by Default</h4><p>Ok, that wasn&rsquo;t really spectacular so far &mdash; getting and setting values could be done simply with variables or a map. An absolute must for every configuration solution is however dealing with default values &mdash; if no custom value has been set, it&rsquo;s the default we should get. Appconf can do this, but we have to defined said default value:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>err <span style=color:#ff79c6>:=</span> conf.<span style=color:#50fa7b>NewOption</span>(<span style=color:#f1fa8c>&#34;port&#34;</span>, appconf.<span style=color:#50fa7b>WithDefaultInt</span>(<span style=color:#bd93f9>8080</span>))
</span></span></code></pre></div><p>Now we have an option called <code>port</code>, which defaults to an integer value of <code>8080</code>. Initially, default value and current value are the same:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>current, err <span style=color:#ff79c6>:=</span> conf.<span style=color:#50fa7b>GetInt</span>(<span style=color:#f1fa8c>&#34;port&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>standard, err <span style=color:#ff79c6>:=</span> conf.<span style=color:#50fa7b>GetDefaultInt</span>(<span style=color:#f1fa8c>&#34;port&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>log.<span style=color:#50fa7b>Printf</span>(<span style=color:#f1fa8c>&#34;Current Port: %d&#34;</span>, current)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>log.<span style=color:#50fa7b>Printf</span>(<span style=color:#f1fa8c>&#34;Default Port: %d&#34;</span>, standard)
</span></span></code></pre></div><p>will result in this output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>Current Port: 8080
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>Default Port: 8080
</span></span></code></pre></div><p>If we now set a different current value for the port option using the <code>conf.SetInt()</code> method, the output for <code>GetInt</code> will change, while the output for <code>GetDefaultInt</code> will still be the same. This allows you to recur to the original default value whenever you need it.</p><p><strong>A word of caution:</strong> Appconf does not check if you assign a value of a different type &mdash; you could define an option with a default type of <code>int</code>, and later assign a string to its current value. If you then try to retrieve the value with <code>GetInt</code>, you might run into an error. <code>GetInt</code> will try its best to return an integer value, even if the current value is a string (it can convert a string like &ldquo;123&rdquo; just fine), but of course it cannot perform real magic and turn &ldquo;Wizzard&rdquo; into an integer value. Therefore I strongly recommend you chose a type when creating an option, and stick with this type.</p><h4 id=now-im-hooked>Now I&rsquo;m Hooked</h4><p>But wait, Appconf is meant to be a configuration solution, so we don&rsquo;t want to call <code>SetInt</code> and the like at all. Don&rsquo;t worry, if configured properly, you won&rsquo;t have to touch any of the <code>Set</code> methods. Instead, we can make Appconf do the dirty work for us and update the current value of our options to whatever the configuration tells. We just have to tell Appconf where it should look for the current value for an option:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>err <span style=color:#ff79c6>:=</span> conf.<span style=color:#50fa7b>NewOption</span>(<span style=color:#f1fa8c>&#34;port&#34;</span>, appconf.<span style=color:#50fa7b>WithDefaultInt</span>(<span style=color:#bd93f9>8080</span>), appconf.<span style=color:#50fa7b>WithFlag</span>(<span style=color:#f1fa8c>&#34;p&#34;</span>), appconf.<span style=color:#50fa7b>WithEnv</span>(<span style=color:#f1fa8c>&#34;PORT&#34;</span>), appconf.<span style=color:#50fa7b>WithJson</span>(<span style=color:#f1fa8c>&#34;server.port&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4>// can only be called once, so do call it after having defined all options</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>conf.<span style=color:#50fa7b>Update</span>()
</span></span></code></pre></div><p>Now we have hooked our <code>port</code> option to the command line flag <code>-p</code>, to the environment variable <code>PORT</code> and to the JSON key <code>server.port</code>. What Appconf does now is the following:</p><p>First, it will look for configuration files. By default these reside in <code>UserConfigDir</code>, <code>SiteConfigDir</code> or <code>GlobalConfigDir</code> and are called <code>config.json</code>. Alternatively, on Unix systems <code>/etc/appname.json</code> also works. Appconf will parse all configuration files it found, so if there&rsquo;s more than one matching for this application, we cannot be sure which one was parsed last and thus had the final say about configuration values. Let&rsquo;s assume we only created one file, <code>/etc/appname/config.json</code> with the following content:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#ff79c6>&#34;server&#34;</span>: {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>        <span style=color:#ff79c6>&#34;host&#34;</span>: <span style=color:#f1fa8c>&#34;localhost&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>        <span style=color:#ff79c6>&#34;port&#34;</span>: <span style=color:#bd93f9>3000</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}
</span></span></code></pre></div><p>The port option can be accessed by concatenating the keys, using <code>.</code> as a separator (i.e. <code>server.host</code>, <code>server.port</code>). Since Appconf found our configuration file, the current value of our <code>port</code> option is now <code>3000</code>, while the default still is <code>8080</code>.</p><p>Next, Appconf will look for environment variables. If we set the environment variable <code>PORT</code> to <code>8000</code>, Appconf will update the current value of the <code>port</code> option to <code>8000</code>. So environment variables override configuration files.</p><p>Finally, Appconf will look at command line flags. If it finds <code>-p &lt;port></code> or <code>-p=&lt;port></code>, it will set the current value of the <code>port</code> option to whatever was provided via the command line. Command line flags override both, configuration files and environment variables.</p><p>Oh, and by the way, when using command line flags it would be a good idea to define a help text, explaining the configuration option:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>err <span style=color:#ff79c6>:=</span> conf.<span style=color:#50fa7b>NewOption</span>(<span style=color:#f1fa8c>&#34;port&#34;</span>, appconf.<span style=color:#50fa7b>WithDefaultInt</span>(<span style=color:#bd93f9>8080</span>), appconf.<span style=color:#50fa7b>WithFlag</span>(<span style=color:#f1fa8c>&#34;p&#34;</span>), appconf.<span style=color:#50fa7b>WithHelp</span>(<span style=color:#f1fa8c>&#34;TCP port to listen on&#34;</span>))
</span></span></code></pre></div><p>This way, we can work with a configuration file on our testbed or development system, use environment variables when deploying to the cloud or a container, and can use command line flags to temporarily override options e.g. for testing or diagnostic purposes. Pretty cool, isn&rsquo;t it?</p><h4 id=caveats-and-the-plumbing>Caveats and the Plumbing</h4><p>Now while the default behaviour of Appconf covers my personal needs fairly well, there are a few edge cases where you might need to deal with Appconf&rsquo;s inner plumbing to achieve what you need. Let&rsquo;s look at these use cases:</p><p>If you want to use Appconf with a different precendence order, you can do so by calling <code>conf.UpdateFromFiles()</code>,<code>conf.UpdateFromEnv()</code> and <code>conf.UpdateFromFlags()</code> in arbitrary order. Just keep in mind that you can call <code>conf.UpdateFromFlags()</code> only once, which is a limitation of the underlying <a href=https://pkg.go.dev/flag>flag</a> package.</p><p>The same limitation applies if you want to define command line flags outside of Appconf&rsquo;s configuration context. You can do so using the <code>flag.BoolVar</code>, <code>flag.IntVar</code> etc. functions from the <a href=https://pkg.go.dev/flag>flag</a> package, but make sure you don&rsquo;t call <code>flag.Parse()</code> &mdash; Appconf will call it within its <code>UpdateFromFlags()</code> method.</p><p>If you want to access stored options directly, you can do so via the Appconf context object:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>conf <span style=color:#ff79c6>:=</span> appconf.<span style=color:#50fa7b>NewConf</span>(<span style=color:#f1fa8c>&#34;MyApp&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>err <span style=color:#ff79c6>:=</span> conf.<span style=color:#50fa7b>NewOption</span>(<span style=color:#f1fa8c>&#34;port&#34;</span>, appconf.<span style=color:#50fa7b>WithDefaultInt</span>(<span style=color:#bd93f9>8080</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>portString <span style=color:#ff79c6>:=</span> conf.Options[<span style=color:#f1fa8c>&#34;port&#34;</span>].Value.<span style=color:#50fa7b>ToString</span>()
</span></span></code></pre></div><p><strong>Warning:</strong> <code>option.Value</code> and <code>option.Default</code> are interface pointers. If you want to set them directly (which I do not recommend), you need to make sure they receive a deep copy of the value pointer:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>iv <span style=color:#ff79c6>:=</span> <span style=color:#50fa7b>IntValue</span>(<span style=color:#bd93f9>1234</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>conf.Options[<span style=color:#f1fa8c>&#34;port&#34;</span>].Value = iv.<span style=color:#50fa7b>Copy</span>()
</span></span></code></pre></div><p>Also reading them directly is a no-no, since Go doesn&rsquo;t know what type they really are. If for whatever reason you want to access <code>Value</code> or <code>Default</code> directly, use their <code>ToString()</code>, <code>ToInt()</code>, <code>ToBool()</code> and <code>ToFloat64()</code> methods to obtain a Go standard data type.</p><h4 id=my-use-case>My Use Case</h4><p>I use Appconf in several projects. In all of them, I only use the application name to configure the Appconf context. On my local development machine, I use a JSON file located in <code>~/.config/&lt;AppName></code> to set the configuration options, or command line flags if I want to test specific cases. To make the configuration context accessible to all package of the application, I define it as global variable:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>package</span> main
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>import</span> <span style=color:#f1fa8c>&#34;github.com/daemotron/appconf&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#8be9fd;font-style:italic>var</span> Conf appconf.AppConf
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#8be9fd;font-style:italic>func</span> <span style=color:#50fa7b>setup</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    Conf = <span style=color:#50fa7b>NewConf</span>(<span style=color:#f1fa8c>&#34;MyApp&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    Conf.<span style=color:#50fa7b>NewOption</span>(<span style=color:#f1fa8c>&#34;verbose&#34;</span>, appconf.<span style=color:#50fa7b>WithFlag</span>(<span style=color:#f1fa8c>&#34;v&#34;</span>), appconf.<span style=color:#50fa7b>WithDefaultBool</span>(<span style=color:#ff79c6>false</span>), appconf.<span style=color:#50fa7b>WithHelp</span>(<span style=color:#f1fa8c>&#34;verbose output&#34;</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span></code></pre></div></div><div class=footer><div class=tags><i class="fa fa-tags"></i><div class=links><a href=https://www.my-universe.com/tags/development/>Development</a>
<a href=https://www.my-universe.com/tags/go/>Go</a></div></div></div></article></div><div id=comments-container></div></div><footer><div class=container><div class=recent-posts><strong>Latest posts</strong><ul><li><a href=https://www.my-universe.com/2025/02/14/pilatus-pc-12-x-plane-wallpaper/>Pilatus PC-12 X-Plane Wallpaper</a></li><li><a href=https://www.my-universe.com/2024/04/06/configuration-to-go/>Configuration to Go</a></li><li><a href=https://www.my-universe.com/2023/10/31/elegant-python-exceptions/>Elegant Python Exceptions</a></li><li><a href=https://www.my-universe.com/2023/09/27/dataref-caching-revisited/>Dataref Caching Revisited</a></li><li><a href=https://www.my-universe.com/2023/09/23/configuration-file-with-xppl/>Configuration File with XPPL</a></li><li><a href=https://www.my-universe.com/2023/09/22/introducing-xppl/>Introducing XPPL</a></li><li><a href=https://www.my-universe.com/2023/04/20/cache-your-datarefs/>Cache Your Datarefs</a></li></ul></div><div class=categories><a href=https://www.my-universe.com/categories/><strong>Categories</strong></a><ul><li><a href=https://www.my-universe.com/categories/x-plane/>X-Plane (4)</a></li><li><a href=https://www.my-universe.com/categories/website/>Website (2)</a></li><li><a href=https://www.my-universe.com/categories/go/>Go (1)</a></li><li><a href=https://www.my-universe.com/categories/python/>Python (1)</a></li></ul></div><div class=right><div class=external-profiles><strong>Social media</strong>
<a href=https://github.com/daemotron target=_blank rel><em class="fab fa-github"></em></a>
<a href=https://gitlab.com/daemotron target=_blank rel><em class="fab fa-gitlab"></em></a>
<a href=https://stackoverflow.com/users/5217009/daemotron target=_blank rel=me><em class="fab fa-stack-overflow"></em></a>
<a href=https://www.linkedin.com/in/jescofreund target=_blank rel><em class="fab fa-linkedin"></em></a>
<a href=/index.xml target=_blank rel><em class="fas fa-rss"></em></a></div><div class=archive><a href=https://www.my-universe.com/archive/><strong>Archive</strong></a></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=https://www.my-universe.com/ target=_blank>&copy;
2017 - 2025
My Universe</a></div><div class=author><a href=https://gohugo.io/ target=_blank>Powered by Hugo & Bilberry Hugo Theme</a></div></div></div><script src=https://www.my-universe.com/theme.js></script></body></html>