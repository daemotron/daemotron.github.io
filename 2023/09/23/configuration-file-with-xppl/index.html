<!doctype html><html itemscope itemtype=https://schema.org/WebPage class=no-js lang=en><head prefix="og: http://ogp.me/ns#"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=siteBaseUrl content="https://www.my-universe.com/"><meta name=author content="daemotron"><meta name=description content="Mens Insana in Corpore Ignavo"><meta name=keywords content="blog,developer,personal"><meta name=generator content="Hugo 0.142.0"><title>Configuration File with XPPL | My Universe
</title><meta itemprop=name content="Configuration File with XPPL"><meta itemprop=description content="Configuration File with XPPL - Mens Insana in Corpore Ignavo"><meta property="og:site_name" content="My Universe"><meta property="og:url" content="https://www.my-universe.com/2023/09/23/configuration-file-with-xppl/"><meta property="og:site_name" content="My Universe"><meta property="og:title" content="Configuration File with XPPL"><meta property="og:description" content="In this blog post we’re looking into using XPPL to enhance a plugin with a configuration file. Working with XPPL’s configuration module is follows this five-step sequence:
initialize a configuration context register configuration properties load the configuration file access the configuration values clean up First, we need a configuration context. Since we will need to keep it alive throughout the whole plugin life cycle, we declare it as static, global variable:"><meta property="og:locale" content="en_gb"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-23T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-23T00:00:00+00:00"><meta property="article:tag" content="X-Plane"><meta property="article:tag" content="Development"><meta property="article:tag" content="C/C++"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><script src=/modernizr-simple.js></script><link rel=canonical href=https://www.my-universe.com/2023/09/23/configuration-file-with-xppl/><link rel=stylesheet href=https://www.my-universe.com/theme.css></head><body class=bilberry-hugo-theme><nav><div class=container><ul class=topnav><li><a href=https://www.my-universe.com/page/about/>About</a></li><li><a href=https://www.my-universe.com/page/legal/>Legal</a></li></ul></div></nav><header><div class=container><div class=logo><a href=/ class=logo><img src=/img/avataaars.png alt>
<span class=overlay><i class="fa fa-home"></i></span></a></div><div class=titles><h3 class=title><a href=/>My Universe</a></h3><span class=subtitle>Mens Insana in Corpore Ignavo</span></div><div class=toggler><i class="fa fa-bars" aria-hidden=true></i></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=https://www.my-universe.com/2023/09/23/configuration-file-with-xppl/><i class="fas fa-fw fa-pencil-alt"></i></a><article class="default article"><div class=content><h1 class=article-title><a href=https://www.my-universe.com/2023/09/23/configuration-file-with-xppl/>Configuration File with XPPL</a></h1><div class=meta><span class="date moment">2023-09-23</span>
<span class=categories><a href=https://www.my-universe.com/categories/x-plane/>X-Plane</a></span></div><p>In this blog post we&rsquo;re looking into using <a href=https://github.com/daemotron/xppl/>XPPL</a> to enhance a plugin with a configuration file. Working with XPPL&rsquo;s configuration module is follows this five-step sequence:</p><ol><li>initialize a configuration context</li><li>register configuration properties</li><li>load the configuration file</li><li>access the configuration values</li><li>clean up</li></ol><p>First, we need a configuration context. Since we will need to keep it alive throughout the whole plugin life cycle, we declare it as static, global variable:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;xppl.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;xppl_config.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>xppl_config_ctx_t</span> CfgCtx;
</span></span></code></pre></div><p>I recommend to initialize the configuration context in the <code>XPluginStart</code> callback function. For writing portable code, I strongly recommend enabling X-Plane&rsquo;s native paths feature (as also proposed by <a href=https://developer.x-plane.com/sdk/XPLMUtilities/#Directory_Separators>X-Plane&rsquo;s API documentation</a>)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdbool.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;XPLMPlugin.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;XPLMUtilities.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>PLUGIN_API <span style=color:#8be9fd>int</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#50fa7b>XPluginStart</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>outName, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>outSig, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>outDesc)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#50fa7b>XPLMEnableFeature</span>(<span style=color:#f1fa8c>&#34;XPLM_USE_NATIVE_PATHS&#34;</span>, <span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#50fa7b>xppl_config_init</span>(<span style=color:#ff79c6>&amp;</span>CfgCtx, <span style=color:#f1fa8c>&#34;Daemoplug Configuration&#34;</span>, <span style=color:#f1fa8c>&#34;Output/daemoplug/config.txt&#34;</span>, <span style=color:#50fa7b>XPLMGetDirectorySeparator</span>(), <span style=color:#8be9fd;font-style:italic>true</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>}
</span></span></code></pre></div><p>Before XPPL can read configuration properties from a file, we have to tell it about the properties it should read &mdash; much safer and easier to have a parser that only processes what it knows, and ignores the rest&mldr; In the example below, we register two configuration properties:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd>long</span> <span style=color:#8be9fd>long</span> default_int <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1234</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>default_str <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;Hello World&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#50fa7b>xppl_config_register</span>(<span style=color:#ff79c6>&amp;</span>CfgCtx, <span style=color:#f1fa8c>&#34;my_int&#34;</span>, XPPL_CONFIG_INT, <span style=color:#ff79c6>&amp;</span>default_int, <span style=color:#f1fa8c>&#34;My configurable integer&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#50fa7b>xppl_config_register</span>(<span style=color:#ff79c6>&amp;</span>CfgCtx, <span style=color:#f1fa8c>&#34;my_str&#34;</span>, XPPL_CONFIG_STRING, default_str, <span style=color:#f1fa8c>&#34;My configurable string&#34;</span>);
</span></span></code></pre></div><p>Now the configuration context &ldquo;knows&rdquo; to expect two entries in the configuration file, one named <code>my_int</code> with a signed (long) integer as value, and <code>my_str</code>, with a string as value. Now we&rsquo;re ready to load and parse the configuration file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#50fa7b>xppl_config_load</span>(<span style=color:#ff79c6>&amp;</span>Cfg_Ctx);
</span></span></code></pre></div><p>This short statement is the gist of XPPL&rsquo;s configuration voodoo: It will check whether the configuration file set for the context exists. If it doesn&rsquo;t and the context was initialized the way we did, it creates the configuration file with the default values we indicated when registering the different configuration properties. And finally, it reads and parses the configuration file and updates the configuration property values stored within the configuration context.</p><p>The generated configuration file looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4># Daemoplug Configuration</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4># =======================</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4># My configuration integer</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#50fa7b>my_int</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>1234</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#6272a4># My configuration string</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#50fa7b>my_str</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>Hello World</span>
</span></span></code></pre></div><p><strong>NB:</strong> you can call <code>xppl_config_load</code> as often as you want (or need) on the same context to re-load values from the configuration file. Adding it to the <code>XPluginEnable</code> callback will make sure the configuration file is read and parsed everytime the user disables and re-enables the plugin in X-Plane&rsquo;s plugin admin.</p><p>Accessing configuration property values is fairly straight forward, but you&rsquo;ll need to use the correct function for the configuration value&rsquo;s data type:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd>long</span> <span style=color:#8be9fd>long</span> conf_int;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#8be9fd>char</span> conf_str[<span style=color:#bd93f9>255</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>conf_int <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>xppl_config_data_get_i</span>(<span style=color:#ff79c6>&amp;</span>CfgCtx, <span style=color:#f1fa8c>&#34;my_int&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#8be9fd>size_t</span> len <span style=color:#ff79c6>=</span> <span style=color:#50fa7b>xppl_config_data_get_s</span>(<span style=color:#ff79c6>&amp;</span>CfgCtx, <span style=color:#f1fa8c>&#34;my_str&#34;</span>, conf_str, <span style=color:#bd93f9>255</span>);
</span></span></code></pre></div><p>The getters for integer, float and unsigned return the configuration value as scalar, while the string getter requires a buffer and returns the length of the string copied into the buffer.</p><p><strong>NB:</strong> even if the function names use the most popular designation for a data type, the actual data type used is always the longest possible: &ldquo;integer&rdquo; is represented by <code>long long</code>, &ldquo;float&rdquo; by <code>long double</code>, and &ldquo;unsigned&rdquo; by <code>unsigned long long</code>. If your code requires smaller data types, you&rsquo;ll need to cast them.</p><p>Finally, we need to clean up the context when shutting down the plugin. This is best done here:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>PLUGIN_API <span style=color:#8be9fd>void</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#50fa7b>XPluginStop</span>(<span style=color:#8be9fd>void</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#50fa7b>xppl_config_destroy</span>(<span style=color:#ff79c6>&amp;</span>CfgCtx);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>}
</span></span></code></pre></div></div><div class=footer><div class=tags><i class="fa fa-tags"></i><div class=links><a href=https://www.my-universe.com/tags/x-plane/>X-Plane</a>
<a href=https://www.my-universe.com/tags/development/>Development</a>
<a href=https://www.my-universe.com/tags/c/c++/>C/C++</a></div></div></div></article></div><div id=comments-container></div></div><footer><div class=container><div class=recent-posts><strong>Latest posts</strong><ul><li><a href=https://www.my-universe.com/2024/04/06/configuration-to-go/>Configuration to Go</a></li><li><a href=https://www.my-universe.com/2023/10/31/elegant-python-exceptions/>Elegant Python Exceptions</a></li><li><a href=https://www.my-universe.com/2023/09/27/dataref-caching-revisited/>Dataref Caching Revisited</a></li><li><a href=https://www.my-universe.com/2023/09/23/configuration-file-with-xppl/>Configuration File with XPPL</a></li><li><a href=https://www.my-universe.com/2023/09/22/introducing-xppl/>Introducing XPPL</a></li><li><a href=https://www.my-universe.com/2023/04/20/cache-your-datarefs/>Cache Your Datarefs</a></li><li><a href=https://www.my-universe.com/2023/01/14/talk-to-the-log/>Talk to the Log</a></li></ul></div><div class=categories><a href=https://www.my-universe.com/categories/><strong>Categories</strong></a><ul><li><a href=https://www.my-universe.com/categories/x-plane/>X-Plane (3)</a></li><li><a href=https://www.my-universe.com/categories/website/>Website (2)</a></li><li><a href=https://www.my-universe.com/categories/go/>Go (1)</a></li><li><a href=https://www.my-universe.com/categories/python/>Python (1)</a></li></ul></div><div class=right><div class=external-profiles><strong>Social media</strong>
<a href=https://github.com/daemotron target=_blank rel><em class="fab fa-github"></em></a>
<a href=https://gitlab.com/daemotron target=_blank rel><em class="fab fa-gitlab"></em></a>
<a href=https://stackoverflow.com/users/5217009/daemotron target=_blank rel=me><em class="fab fa-stack-overflow"></em></a>
<a href=https://www.linkedin.com/in/jescofreund target=_blank rel><em class="fab fa-linkedin"></em></a>
<a href=/index.xml target=_blank rel><em class="fas fa-rss"></em></a></div><div class=archive><a href=https://www.my-universe.com/archive/><strong>Archive</strong></a></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=https://www.my-universe.com/ target=_blank>&copy;
2017 - 2025
My Universe</a></div><div class=author><a href=https://gohugo.io/ target=_blank>Powered by Hugo & Bilberry Hugo Theme</a></div></div></div><script src=https://www.my-universe.com/theme.js></script></body></html>